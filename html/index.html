<!DOCTYPE HTML>
<head>
	<meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=5" name=viewport>
	<style>body{font-family:monospace;font-size:16px;line-height:1.5;padding:8px 32px;background-color:#282a36;color:#ddd}code{background-color:#111;padding:0 3px;border-radius:3px;font-size:15px;display:inline-block}h3,strong{font-weight:600}a{color:#8be9fd}@media (min-width:1312px){body{padding:16px;max-width:1280px;margin:8px auto}}</style>
	<title>KatWebX Demo Page</title>
</head>
<body>
	<h3>Welcome to KatWebX!</h3>
	<p>KatWebX is an extremely fast web-server and reverse proxy for the modern web. Its features are listed below.</p>
	<ul>
		<li>Flexible config parsing</li>
		<li>Regex-based redirects</li>
		<li>Compressed regex-based reverse proxy</li>
		<li>HTTP basic authentication</li>
		<li>Fast file serving</li>
		<li>Brotli file compression</li>
		<li>HSTS support</li>
		<li>SNI and OCSP reponse stapling</li>
		<li>High peformance HTTP/2 and TLS 1.3</li>
		<li>Multiple logging types</li>
		<li>Material design server-generated pages</li>
	</ul>
	<p>You can continue reading the content on this page to learn how to configure KatWebX properly.</p>

	<hr>
	<h3>Folder structure</h3>
	<p>KatWebX keeps all of its data contained with its folder. The folder structure is listed below.</p>
	<ul>
		<li>/html/ - Default web server root.
			<ul>
				<li>/index.html - Root index page.</li>
			</ul>
		</li>
		<li>/[domain]/ - File system root for [domain].
			<ul>
				<li>/index.html - Root index page.</li>
			</ul>
		</li>
		<li>/ssl/ - Server TLS certificates.
			<ul>
				<li>/default.crt - Default TLS certificate.</li>
				<li>/default.pem - Default certificate key.</li>
				<li>/default.ocsp - Default OCSP reponse (optional).</li>
				<li>/[domain].crt - TLS certificate for [domain].</li>
				<li>/[domain].pem - Certificate key for [domain].</li>
				<li>/[domain].ocsp - OCSP response for [domain].</li>
			</ul>
		</li>
		<li>/src/ - Program source code.
			<ul>
				<li>/*.rs - Rust source code.</li>
			</ul>
		</li>
		<li>/conf.json - Global configuration file.</li>
	</ul>

	<hr>
	<h3>Global configuration</h3>
	<p>KatWebX's global configuration is stored in the /conf.json file. Changes made to this file only take effect after KatWebX has been restarted.</p>
	<ul>
		<li>cachingTimeout (default: 4) - How long requests should be cached by the client, in hours. Setting this to zero will disable client-side caching.</li>
		<li>streamTimeout (default: 20) - The maximum amount of time a connection can be kept open, in seconds. If you intend to transfer large files, setting this higher is recommended.</li>
		<li>hsts (default: false) - Send HSTS headers, and redirect HTTP requests to HTTPS. This will enable HSTS preloading.</li>
		<li>proxy (array) - HTTP(S) reverse proxy.
			<ul>
				<li>location (type: host, regex: url) - The location where the proxy can be accessed.</li>
				<li>host (type: absolute-url) - The URL of the location being proxied.</li>
			</ul>
		</li>
		<li>redir (array) - Permanent HTTP redirects.
			<ul>
				<li>location (type, regex: url) - The location the redirect affects.</li>
				<li>dest (type: absolute-url) - The URL to redirect to.</li>
			</ul>
		</li>
		<li>auth (array) - HTTP basic authentication.
			<ul>
				<li>location (regex: url) - The location the password-protection affects.</li>
				<li>login (type: login) - The credentials required to access the resource.</li>
			</ul>
		</li>
		<li>hide (array: [type, regex: host]) - List of folders to ignore.</li>
		<li>advanced - Advanced KatWebX configuration
			<ul>
				<li>protect (default: true) - Increase website security using HTTP headers.</li>
				<li>compressfiles (default: true) - Automatically compress resources with Brotli compression. Disaling this will not prevent pre-compressed resources from being served, or disable on-the-fly compression.</li>
				<li>logformat (type: logtype, default: simple) - Logging format used.</li>
				<li>httpAddr (type: listen-host, default: [::]:80) - Location to listen for HTTP requests.</li>
				<li>tlsAddr (type: listen-host, default: [::]:443) - Location to listen for HTTPS requests.</li>
			</ul>
		</li>
	</ul>

	<hr>
	<h3>Configuration types</h3>
	<p>Normal types are automatically used, regex types can be used by prefixing the configuration string with <code>#r</code>. When the string is set to its regex type, the string set in the configuration is parsed as regex.</p>
	<ul>
		<li>Host - An IPv4/IPv6 address or domain (ex. example.com)</li>
		<li>Listen-host - An IPv4/IPv6 address and port (ex. 127.0.0.1:443)</li>
		<li>Url - A URL without protocol (ex. example.com/page.html)</li>
		<li>Absolute-url - A url with protocol (ex. https://example.com/page.html)</li>
		<li>Login - A password and username split with <code>:</code> (ex. admin:passwd)</li>
		<li>Logtype - A logging format. Supported values: combinedvhost, combined, commonvhost, common, simpleplus, simple, minimal, none</li>
	</ul>

	<hr>
	<h3>Loading certificate and key pairs</h3>
	<p>To use a certificate and key, you must name the certificate <code>[domain].crt</code>, and the key <code>[domain].pem</code>. The certificate used is automatically detected using SNI. If no matching certificate is present, the files <code>default.crt</code> and <code>default.pem</code> will be used instead.</p>
	<p>The keyfile <strong>must</strong> be in pkcs8 format. You can convert it into pkcs8 using the command below (requires openssl): <code>openssl pkcs8 -topk8 -nocrypt -in oldkey.pem -out newkey.pem</code></p>
	<hr>
	<h3>Getting a TLS certificate</h3>
	<p>You can get free TLS certificates from Let's Encrypt through the use of an ACME client, like <a href="https://www.sslforfree.com/">sslforfree.com</a>.</p>
	<p>Note: It is heavily recommended that you generate your own ECDSA key and CSR instead of letting the ACME client do it. Most ACME clients default to using RSA instead of ECDSA, which will result in reduced server peformance.</p>

	<hr>
	<h3>Forcing encrypted connections using HSTS</h3>
	<p>It's highly recommended that you make all internet-facing sites HTTPS only. To do so, you can enable the <code>conf.hsts</code> configuration option. This will automatically redirect all requests to HTTPS, and set an HSTS header, to allow for HSTS preloading. You can then request for your site to be added to the HSTS preload list <a href="https://hstspreload.org/">here</a>.</p>
	<p>Note: Once you are on the preload list, it is very difficult to get off it. Make sure your site works properly over HTTPS before doing this!</p>

	<hr>
	<h3>OCSP stapling</h3>
	<p>KatWebX supports stapling an OCSP response, but it doesn't have a builtin OCSP client. If you split the certificate chain into two files, you can get an OCSP reponse manually using the commands below (requires openssl and bash): <code>URI=$(openssl x509 -noout -ocsp_uri -in server.crt)</code><code>openssl ocsp -issuer ca.crt -cert server.crt -url $URI -respout output.ocsp</code></p>
	<p>You can then apply it to a host by renaming the file to <code>[domain].ocsp</code>. Note that this file must be renewed often (usually every 7 days) to prevent it from expiring.</p>

	<hr>
	<h3>Peformance optimization</h3>
	<p>Although KatWebX is designed to be high-peformance, it may need a bit of extra tweaking when under extreme load. Here's some tips on how to improve KatWebX's peformance.</p>
	<ul>
		<li>Use the latest version of KatWebX. KatWebX is constantly being optimized, and newer versions can bring noticeable performance improvements (and even if they don't, using outdated releases can put your server's security at risk).</li>
		<li>Set conf.advanced.logformat to "minimal" or "none". Disabling logging heavily reduces latency and CPU load.</li>
		<li>Avoid using regex in the config whenever possible. Heavy use of regex can be extremely intensive.</li>
		<li>Try keeping files below 64kb in size. Small files can be copied directly into the response, which is ~2x faster than using streaming IO.</li>
		<li>If you are using RSA key sizes greater than 2048, consider switching to ECDSA instead.</li>
		<li>Avoid using unknown extensions. When the file extension is unknown, the server has to sniff the MIME type manually, which has a significant peformance impact.</li>
		<li>Make sure conf.advanced.compressfiles is enabled. This heavily reduces CPU load by pre-compressing files, instead of requiring data to be compressed in realtime.</li>
		<li>Make sure conf.cachingTimeout is set to a high value. More client side caching will result in fewer requests to the server.</li>
	</ul>
</body>
